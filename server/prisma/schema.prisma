generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

enum ResumeStatus {
  UPLOADED
  PARSED
  FAILED
}

enum PortfolioStatus {
  DRAFT
  PUBLISHED
}

model User {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  password  String
  avatarUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  resumes    Resume[]
  portfolios Portfolio[]
}

model Resume {
  id         String   @id @default(uuid())
  userId     String
  fileUrl    String
  fileType   String   // pdf, docx
  fileHash   String   // deduplication + audit
  status     ResumeStatus
  uploadedAt DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id])
  parsedData ResumeParsedData?
}

model ResumeParsedData {
  id        String @id @default(uuid())
  resumeId String @unique

  basics      Json   // name, title, summary, location
  skills      Json
  experience  Json
  education   Json
  projects    Json
  socials     Json

  updatedAt DateTime @updatedAt

  resume Resume @relation(fields: [resumeId], references: [id])
}

model PortfolioTemplate {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  previewUrl  String
  description String?
  isPremium   Boolean @default(false)

  createdAt DateTime @default(now())

  portfolios Portfolio[]
  tags       PortfolioTemplateTag[]
}

model Tag {
  id   String @id @default(uuid())
  name String @unique

  templates PortfolioTemplateTag[]
}

model PortfolioTemplateTag {
  id                 String @id @default(uuid())
  portfolioTemplateId String
  tagId              String

  portfolioTemplate PortfolioTemplate @relation(fields: [portfolioTemplateId], references: [id])
  tag               Tag               @relation(fields: [tagId], references: [id])

  @@unique([portfolioTemplateId, tagId])
}

model Portfolio {
  id          String   @id @default(uuid())
  userId      String
  templateId  String
  title       String

  dataSnapshot Json   // frozen resume data
  status       PortfolioStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User              @relation(fields: [userId], references: [id])
  template PortfolioTemplate @relation(fields: [templateId], references: [id])

  sections PortfolioSectionConfig[]
  theme    PortfolioThemeConfig?
  public   PortfolioPublic?
}

model PortfolioSectionConfig {
  id          String @id @default(uuid())
  portfolioId String

  sectionKey  String // about, skills, projects, experience
  orderIndex  Int
  isVisible   Boolean @default(true)

  portfolio Portfolio @relation(fields: [portfolioId], references: [id])
}

model PortfolioThemeConfig {
  id          String @id @default(uuid())
  portfolioId String @unique

  themeName   String
  colors      Json
  fonts       Json
  layout      Json

  portfolio Portfolio @relation(fields: [portfolioId], references: [id])
}

model PortfolioPublic {
  id          String @id @default(uuid())
  portfolioId String @unique

  slug        String @unique
  views       Int    @default(0)

  publishedAt DateTime @default(now())

  portfolio Portfolio @relation(fields: [portfolioId], references: [id])
}